### Variables
@baseUrl = http://localhost:8080/api
# Note: Tokens expire after 24 hours. Get fresh tokens by running the login requests below.
@adminToken = YOUR_ADMIN_TOKEN_HERE
@caregiverToken = YOUR_CAREGIVER_TOKEN_HERE
@residentToken = YOUR_RESIDENT_TOKEN_HERE

### Test Users
@adminId = 550e8400-e29b-41d4-a716-446655440001
@caregiverId = 550e8400-e29b-41d4-a716-446655440002
@residentId = 550e8400-e29b-41d4-a716-446655440004

### 1. Login as Admin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@mos.test",
  "password": "password123"
}

### 2. Login as Caregiver
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "caregiver@mos.test",
  "password": "password123"
}

### 3. Login as Resident
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "resident1@mos.test",
  "password": "password123"
}

### 4. Get Current User Info
GET {{baseUrl}}/auth/me
Authorization: Bearer {{adminToken}}

### 5. Create Reminder (Admin)
POST {{baseUrl}}/users/{{adminId}}/reminders
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "type": "once",
  "category": "meal",
  "dateTime": "2024-01-25T12:00:00Z",
  "note": "Test reminder from admin"
}

### 6. Create Reminder (Caregiver for Resident)
POST {{baseUrl}}/users/{{residentId}}/reminders
Authorization: Bearer {{caregiverToken}}
Content-Type: application/json

{
  "type": "daily",
  "category": "medication",
  "dateTime": "2024-01-25T08:00:00Z",
  "note": "Morning medication"
}

### 7. Get Reminders for User
GET {{baseUrl}}/users/{{residentId}}/reminders
Authorization: Bearer {{caregiverToken}}

### 8. Update Reminder
PUT {{baseUrl}}/users/{{residentId}}/reminders/{{reminderId}}
Authorization: Bearer {{caregiverToken}}
Content-Type: application/json

{
  "type": "once",
  "category": "medication",
  "dateTime": "2024-01-25T09:00:00Z",
  "note": "Updated reminder note"
}

### 9. Delete Reminder
DELETE {{baseUrl}}/users/{{residentId}}/reminders/{{reminderId}}
Authorization: Bearer {{caregiverToken}}

### 10. Set Meal Requirements (New format with array)
POST {{baseUrl}}/users/{{residentId}}/meal-requirements
Authorization: Bearer {{caregiverToken}}
Content-Type: application/json

{
  "requirements": ["Vegetarisk", "Glutenfri", "Custom requirement"]
}

### 11. Get Meal Requirements
GET {{baseUrl}}/users/{{residentId}}/meal-requirements
Authorization: Bearer {{caregiverToken}}

### 12. Test Invalid Category (should fail)
POST {{baseUrl}}/users/{{residentId}}/reminders
Authorization: Bearer {{caregiverToken}}
Content-Type: application/json

{
  "type": "once",
  "category": "lunch",
  "dateTime": "2024-01-25T12:00:00Z",
  "note": "This should fail"
}

### 13. Test admin accessing resident data
GET {{baseUrl}}/users/{{residentId}}/reminders
Authorization: Bearer {{adminToken}}

### ===== NEW USER PERMISSION SYSTEM ENDPOINTS =====

### 14. Get Current User Permissions
GET {{baseUrl}}/user-management/permissions
Authorization: Bearer {{adminToken}}

### 15. Get All Caretakers (for caregiver)
GET {{baseUrl}}/user-management/caretakers
Authorization: Bearer {{caregiverToken}}

### 16. Create New Caretaker (caregiver only)
POST {{baseUrl}}/user-management/caretakers
Authorization: Bearer {{caregiverToken}}
Content-Type: application/json

{
  "name": "New Resident",
  "email": "newresident@mos.test"
}

### 16b. Create New User (admin only) - NEW ENDPOINT
# This endpoint allows admins to create any type of user (ADMIN, CAREGIVER, RESIDENT)
# and automatically grants appropriate permissions based on user type
POST {{baseUrl}}/user-management/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "name": "New Caregiver",
  "email": "newcaregiver@mos.test",
  "password": "password123",
  "userType": "CAREGIVER"
}

### 16c. Create New Admin User (admin only)
POST {{baseUrl}}/user-management/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "name": "New Admin",
  "email": "newadmin@mos.test",
  "password": "password123",
  "userType": "ADMIN"
}

### 16d. Create New Resident User (admin only)
POST {{baseUrl}}/user-management/admin/users
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "name": "New Resident",
  "email": "newresident@mos.test",
  "password": "password123",
  "userType": "RESIDENT"
}

### 17. Set Permissions for Caretaker
PUT {{baseUrl}}/user-management/caretakers/{{newCaretakerId}}/permissions
Authorization: Bearer {{caregiverToken}}
Content-Type: application/json

{
  "permissions": [
    {
      "permissionName": "VIEW_REMINDERS",
      "isEnabled": true
    },
    {
      "permissionName": "CREATE_REMINDERS",
      "isEnabled": false
    }
  ]
}

### 18. Delete Caretaker
DELETE {{baseUrl}}/user-management/caretakers/{{newCaretakerId}}
Authorization: Bearer {{caregiverToken}}

### ===== PERMISSION TESTING =====

### 19. Test Permission Denied (resident trying to access admin endpoint)
GET {{baseUrl}}/user-management/caretakers
Authorization: Bearer {{residentToken}}

### 20. Test Permission Denied (caregiver without MEAL_REQUIREMENTS permission)
POST {{baseUrl}}/users/{{residentId}}/meal-requirements
Authorization: Bearer {{caregiverToken}}
Content-Type: application/json

{
  "requirements": ["Test requirement"]
}

### ===== UTILITY ENDPOINTS =====

### 21. Get All Users (admin only)
GET {{baseUrl}}/users
Authorization: Bearer {{adminToken}}

### 22. Health Check
GET {{baseUrl}}/health
